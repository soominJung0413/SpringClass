<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- association : 1:N에서 N쪽의 정보를 조회할 때 1쪽의 정보도 함께 읽을 것임 -->

<mapper namespace="www.study.com.search.mapper.HashTagMapper">
		<resultMap
		 	type="www.study.com.search.model.HashTagVO" id="hashTagResultMap">
			<id column="id" javaType="Long"  property="id"/>
			<result column="tag" javaType="String" property="tag"/>
			<result column="descript" property="descript"/>
		</resultMap>
		
		<!-- public List<HashTagVO> findExist(@Param("listHashTag") List<HashTagVO> listHashTag); -->
		<select id="findExist" resultMap="hashTagResultMap">
				  select *
					  from t_hashtag 
				  where tag in 
				  <trim prefix="(" suffix=")">
				  <foreach collection="listHashTag" item="tagObj"  separator=",">
				  	#{tagObj.tag, jdbcType=VARCHAR}
				  </foreach>
				  </trim>
		</select>
		
		<!-- public int createHashTag(HashTagVO tag); -->
		<insert id="createHashTag">
			<selectKey resultType="Long" order="BEFORE" keyProperty="id">
				select nextval('seq4hashtag')
			</selectKey>
			insert into t_hashtag ( id, tag, descript ) values (
				#{id}, #{tagObj.tag} , #{tagObj.descript}
			)
		</insert>
		
		<!-- public void createMapping2Post(@Param("hierarchyId") String hierarchyId,
			@Param("listHashTag") List<HashTagVO> listHashTag); -->
		<insert id="createMapping2Post" parameterType="java.util.List">
			insert into m_post2tag  (tag_id, post_id)  values
			<foreach collection="listHashTag" item="tagObj" separator=" , " >
		        (#{tagObj.id }, #{hierarchyId, jdbcType=VARCHAR})
		    </foreach>
		</insert>
			
</mapper>